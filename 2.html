<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Игровой каталог</title>
<style>
  body {
    font-family: 'Segoe UI', sans-serif;
    margin: 0; padding: 0; background: #000; color: #0f0;
    transition: background-color 0.3s, color 0.3s;
  }
  body.light-mode {
    background: #fff; color: #333;
  }
  header {
    text-align: center; padding: 20px; background: #111;
  }
  body.light-mode header {
    background: #eee;
  }
  #search, #theme-toggle {
    width: 80%; max-width: 500px; margin: 10px auto; padding: 12px; border-radius: 8px;
    border: 1px solid #0f0; background: #222; color: #0f0; font-size: 1rem;
    display: block; box-sizing: border-box;
  }
  #search:focus, #theme-toggle:focus {
    outline: 2px solid #0f0;
  }
  #game-form {
    width: 80%; max-width: 600px; margin: 20px auto;
    background: #111; padding: 15px; border-radius: 8px;
  }
  label {
    display: block; margin-top: 10px; font-weight: bold;
  }
  input[type=text], input[type=number] {
    width: 100%; padding: 8px; margin-top: 4px; border-radius: 4px;
    border: 1px solid #0f0; background: #222; color: #0f0; box-sizing: border-box;
  }
  button {
    margin-top: 15px; padding: 10px 20px; border: none; border-radius: 6px;
    background: #0f0; color: #000; font-weight: bold; cursor: pointer;
  }
  button:hover {
    background: #0c0; /* чуть темнее */
  }
  #game-list {
    display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 15px; padding: 20px;
  }
  .game-card {
    display: flex; flex-direction: column; background: #111; border-radius: 8px;
    overflow: hidden; color: inherit; transition: all 0.2s;
  }
  .game-card img {
    width: 100%; height: auto; display: block;
  }
  .game-content {
    padding: 10px;
  }
  .game-title {
    font-size: 1.2em; font-weight: bold; margin: 5px 0;
  }
  .game-description, .game-rating, .game-requirements {
    font-size: 0.9em; margin: 5px 0;
  }
  .game-links {
    display: flex; gap: 10px; margin-top: 10px;
  }
  a.btn {
    padding: 8px 12px; border-radius: 4px; background: #0f0; color: #000; text-decoration: none; font-weight: bold;
  }
  a.btn:hover {
    background: #0c0;
  }
  /* Светлая тема для кнопок */
  body.light-mode a.btn {
    background: #08f; color: #fff;
  }
  body.light-mode a.btn:hover {
    background: #06c;
  }
</style>
</head>
<body>

<header>
  <h1>Каталог игр</h1>
  <button id="theme-toggle">Переключить тему</button>
</header>

<input type="text" id="search" placeholder="Поиск по названию..." />

<form id="game-form">
  <h2>Добавить новую игру</h2>
  <label for="title-input">Название:</label>
  <input id="title-input" type="text" required />
  
  <label for="description-input">Описание:</label>
  <input id="description-input" type="text" required />
  
  <label for="minRequirements-input">Мин. требования:</label>
  <input id="minRequirements-input" type="text" required />
  
  <label for="recommendedRequirements-input">Рекомендуемые требования:</label>
  <input id="recommendedRequirements-input" type="text" required />
  
  <label for="rating-input">Рейтинг (от 1 до 10):</label>
  <input id="rating-input" type="number" min="1" max="10" required />
  
  <label for="downloadLink-input">Ссылка на скачивание:</label>
  <input id="downloadLink-input" type="text" required />
  
  <label for="trailerUrl-input">Ссылка на трейлер (опционально):</label>
  <input id="trailerUrl-input" type="text" />

  <button type="submit">Добавить игру</button>
</form>

<div id="game-list"></div>

<script>
  // Объявление переменных
  const themeToggleBtn = document.getElementById('theme-toggle');
  const body = document.body;
  const searchInput = document.getElementById('search');
  const gameForm = document.getElementById('game-form');
  const gameListEl = document.getElementById('game-list');

  let games = [];

  // Функция escapeHTML для защиты от XSS
  function escapeHTML(str) {
    return str
      .replace(/&/g, '&amp;')
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;')
      .replace(/"/g, '&quot;')
      .replace(/'/g, '&#039;');
  }

  // Переключение темы
  themeToggleBtn.addEventListener('click', () => {
    body.classList.toggle('light-mode');
  });

  // Загрузка игр из localStorage
  function loadGames() {
    const saved = localStorage.getItem('games');
    if (saved) {
      try {
        games = JSON.parse(saved);
      } catch {
        games = [];
      }
    }
  }

  // Сохранение в localStorage
  function saveGames() {
    localStorage.setItem('games', JSON.stringify(games));
  }

  // Создание карточки игры
  function createGameCard(game) {
    const card = document.createElement('div');
    card.className = 'game-card';

    const img = document.createElement('img');
    img.src = game.photoUrl || 'https://via.placeholder.com/300x180.png?text=Нет+фото';
    img.alt = escapeHTML(game.title);

    const content = document.createElement('div');
    content.className = 'game-content';

    const title = document.createElement('div');
    title.className = 'game-title';
    title.innerHTML = escapeHTML(game.title);

    const description = document.createElement('div');
    description.className = 'game-description';
    description.innerHTML = escapeHTML(game.description);

    const rating = document.createElement('div');
    rating.className = 'game-rating';
    rating.innerHTML = `Рейтинг: ${escapeHTML(game.rating)}`;

    const req = document.createElement('div');
    req.className = 'game-requirements';
    req.innerHTML = `
      <strong>Мин.требования:</strong> ${escapeHTML(game.minRequirements)}<br />
      <strong>Рекомендуемые требования:</strong> ${escapeHTML(game.recommendedRequirements)}
    `;

    const linksDiv = document.createElement('div');
    linksDiv.className = 'game-links';

    const downloadBtn = document.createElement('a');
    downloadBtn.className = 'btn';
    downloadBtn.href = game.downloadLink;
    downloadBtn.target = '_blank';
    downloadBtn.rel = 'noopener noreferrer';
    downloadBtn.textContent = 'Скачать';

    linksDiv.appendChild(downloadBtn);

    if (game.trailerUrl && game.trailerUrl.trim() !== '') {
      const trailerBtn = document.createElement('a');
      trailerBtn.className = 'btn';
      trailerBtn.href = game.trailerUrl;
      trailerBtn.target = '_blank';
      trailerBtn.rel = 'noopener noreferrer';
      trailerBtn.textContent = 'Трейлер';
      linksDiv.appendChild(trailerBtn);
    }

    content.appendChild(title);
    content.appendChild(description);
    content.appendChild(rating);
    content.appendChild(req);
    content.appendChild(linksDiv);

    card.appendChild(img);
    card.appendChild(content);

    return card;
  }

  // Отрисовка игр по фильтру
  function renderGames(filter = '') {
    gameListEl.innerHTML = '';
    const filteredGames = games.filter(game =>
      game.title.toLowerCase().includes(filter.toLowerCase())
    );
    if (filteredGames.length === 0) {
      gameListEl.innerHTML = '<p style="grid-column:1/-1; text-align:center;">Игры не найдены</p>';
      return;
    }

    filteredGames.forEach(game => {
      const card = createGameCard(game);
      gameListEl.appendChild(card);
    });
  }

  // Инициализация: загрузка и отображение
  loadGames();
  renderGames();

  // Обработчик формы
  gameForm.addEventListener('submit', (e) => {
    e.preventDefault();

    const title = document.getElementById('title-input').value.trim();
    const description = document.getElementById('description-input').value.trim();
    const minReq = document.getElementById('minRequirements-input').value.trim();
    const recReq = document.getElementById('recommendedRequirements-input').value.trim();
    const ratingStr = document.getElementById('rating-input').value.trim();
    const downloadLink = document.getElementById('downloadLink-input').value.trim();
    const trailerUrl = document.getElementById('trailerUrl-input').value.trim();

    // Валидация
    const rating = parseInt(ratingStr, 10);
    if (isNaN(rating) || rating < 1 || rating > 10) {
      alert('Рейтинг должен быть числом от 1 до 10');
      return;
    }

    if (!title || !description || !minReq || !recReq || !downloadLink) {
      alert('Пожалуйста, заполните все обязательные поля');
      return;
    }

    const newGame = {
      title,
      description,
      minRequirements: minReq,
      recommendedRequirements: recReq,
      rating,
      downloadLink,
      trailerUrl,
      photoUrl: '' // Можно добавить поле или оставить пустым
    };

    games.push(newGame);
    saveGames();
    renderGames(searchInput.value);
    gameForm.reset();
  });

  // Обработка поиска
  searchInput.addEventListener('input', () => {
    renderGames(searchInput.value);
  });
</script>
</body>
</html>
